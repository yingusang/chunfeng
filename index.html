<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>æ˜¥é£ - é‡äº‹ä¸å†³ï¼Œå¯é—®æ˜¥é£</title>
    <meta name="description" content="æ˜¥é£ - åŸºäºå…­çˆ»å åœçš„å†³ç­–è¾…åŠ©å·¥å…·ï¼Œé‡äº‹ä¸å†³ï¼Œå¯é—®æ˜¥é£">
    <meta name="keywords" content="å…­çˆ»,å åœ,æ˜“ç»,å†³ç­–,æ˜¥é£">
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", "PingFang SC", "Hiragino Sans GB", "Microsoft YaHei", sans-serif;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
            display: flex;
            justify-content: center;
            align-items: center;
            padding: 20px;
        }

        .container {
            background: rgba(255, 255, 255, 0.95);
            border-radius: 20px;
            padding: 40px;
            max-width: 600px;
            width: 100%;
            box-shadow: 0 20px 60px rgba(0, 0, 0, 0.3);
        }

        .header {
            text-align: center;
            margin-bottom: 30px;
        }

        .header h1 {
            font-size: 48px;
            color: #667eea;
            margin-bottom: 10px;
            font-weight: 600;
        }

        .header .slogan {
            font-size: 18px;
            color: #666;
            font-style: italic;
        }

        .input-section {
            margin-bottom: 30px;
        }

        .input-section label {
            display: block;
            margin-bottom: 10px;
            color: #333;
            font-size: 16px;
            font-weight: 500;
        }

        .input-section input {
            width: 100%;
            padding: 15px;
            border: 2px solid #e0e0e0;
            border-radius: 10px;
            font-size: 16px;
            transition: all 0.3s;
        }

        .input-section input:focus {
            outline: none;
            border-color: #667eea;
            box-shadow: 0 0 0 3px rgba(102, 126, 234, 0.1);
        }

        .btn {
            width: 100%;
            padding: 15px;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            border: none;
            border-radius: 10px;
            font-size: 18px;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s;
            margin-bottom: 10px;
        }

        .btn:hover {
            transform: translateY(-2px);
            box-shadow: 0 10px 25px rgba(102, 126, 234, 0.4);
        }

        .btn:active {
            transform: translateY(0);
        }

        .btn-secondary {
            background: linear-gradient(135deg, #f093fb 0%, #f5576c 100%);
        }

        .result-section {
            background: #f8f9fa;
            border-radius: 15px;
            padding: 25px;
            margin-top: 30px;
            display: none;
        }

        .result-section.show {
            display: block;
            animation: slideIn 0.5s ease;
        }

        @keyframes slideIn {
            from {
                opacity: 0;
                transform: translateY(20px);
            }
            to {
                opacity: 1;
                transform: translateY(0);
            }
        }

        .yao-display {
            background: white;
            padding: 20px;
            border-radius: 10px;
            margin: 20px 0;
            text-align: center;
        }

        .yao-line {
            margin: 8px 0;
            font-size: 18px;
            font-family: monospace;
            display: flex;
            justify-content: center;
            align-items: center;
            gap: 10px;
        }

        .yao-symbol {
            font-size: 24px;
            font-weight: bold;
            color: #667eea;
        }

        .changing-mark {
            color: #f5576c;
            font-weight: bold;
        }

        .result-item {
            margin: 15px 0;
            padding: 15px;
            background: white;
            border-radius: 10px;
            border-left: 4px solid #667eea;
        }

        .result-item strong {
            color: #667eea;
            display: block;
            margin-bottom: 5px;
            font-size: 16px;
        }

        .result-item p {
            color: #333;
            line-height: 1.6;
        }

        .conclusion {
            text-align: center;
            padding: 20px;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            border-radius: 10px;
            margin-top: 20px;
            font-size: 20px;
            font-weight: 600;
        }

        .history-section {
            margin-top: 30px;
            display: none;
        }

        .history-section.show {
            display: block;
        }

        .history-item {
            background: white;
            padding: 15px;
            border-radius: 10px;
            margin-bottom: 15px;
            border-left: 4px solid #f5576c;
        }

        .history-time {
            color: #999;
            font-size: 14px;
            margin-bottom: 5px;
        }

        .history-question {
            color: #333;
            font-weight: 500;
            margin-bottom: 5px;
        }

        .history-result {
            color: #666;
            font-size: 14px;
        }

        .loading {
            text-align: center;
            padding: 20px;
            display: none;
        }

        .loading.show {
            display: block;
        }

        .loading-spinner {
            border: 4px solid #f3f3f3;
            border-top: 4px solid #667eea;
            border-radius: 50%;
            width: 40px;
            height: 40px;
            animation: spin 1s linear infinite;
            margin: 0 auto 10px;
        }

        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }

        .emoji {
            font-size: 24px;
        }

        .footer {
            text-align: center;
            margin-top: 30px;
            padding-top: 20px;
            border-top: 1px solid #e0e0e0;
            color: #999;
            font-size: 14px;
        }

        @media (max-width: 600px) {
            .container {
                padding: 20px;
            }
            
            .header h1 {
                font-size: 36px;
            }
            
            .header .slogan {
                font-size: 16px;
            }
        }
    </style>
</head>
<body>
    <div class="container">
        <div class="header">
            <h1>ğŸŒ¸ æ˜¥é£ ğŸŒ¸</h1>
            <p class="slogan">é‡äº‹ä¸å†³ï¼Œå¯é—®æ˜¥é£</p>
        </div>

        <div class="input-section">
            <label for="question">ğŸ’­ è¯·è¾“å…¥ä½ çš„é—®é¢˜ï¼ˆå¯é€‰ï¼‰ï¼š</label>
            <input type="text" id="question" placeholder="ä¾‹å¦‚ï¼šä»Šå¤©é€‚åˆå¼€å§‹æ–°é¡¹ç›®å—ï¼Ÿ">
        </div>

        <button class="btn" onclick="startDivination()">ğŸ² å¼€å§‹å åœ</button>
        <button class="btn btn-secondary" onclick="toggleHistory()">ğŸ“œ æŸ¥çœ‹å†å²è®°å½•</button>

        <div class="loading" id="loading">
            <div class="loading-spinner"></div>
            <p>æ­£åœ¨æ‘‡å¦ä¸­...</p>
        </div>

        <div class="result-section" id="result">
            <h3 style="text-align: center; color: #667eea; margin-bottom: 20px;">ğŸ“¿ å åœç»“æœ</h3>
            
            <div class="yao-display" id="yaoDisplay"></div>

            <div class="result-item">
                <strong>ğŸ”® å¦è±¡</strong>
                <p id="hexagramName"></p>
            </div>

            <div class="result-item">
                <strong>ğŸ“– è§£æ</strong>
                <p id="meaning"></p>
            </div>

            <div class="conclusion" id="conclusion"></div>
        </div>

        <div class="history-section" id="history">
            <h3 style="color: #667eea; margin-bottom: 20px;">ğŸ“œ å†å²è®°å½•</h3>
            <div id="historyList"></div>
        </div>

        <div class="footer">
            <p>æœ¬åº”ç”¨ä»…ä¾›å¨±ä¹å’Œæ–‡åŒ–æ¢ç´¢ï¼Œè¯·ç†æ€§å¯¹å¾…å åœç»“æœ</p>
        </div>
    </div>

    <script>
        // å…«å¦åŸºæœ¬ä¿¡æ¯
        const BAGUA = {
            '111': { name: 'ä¹¾', nature: 'å¤©', attr: 'åˆšå¥' },
            '000': { name: 'å¤', nature: 'åœ°', attr: 'æŸ”é¡º' },
            '100': { name: 'éœ‡', nature: 'é›·', attr: 'åŠ¨' },
            '010': { name: 'å', nature: 'æ°´', attr: 'é™©' },
            '001': { name: 'è‰®', nature: 'å±±', attr: 'æ­¢' },
            '011': { name: 'å·½', nature: 'é£', attr: 'å…¥' },
            '101': { name: 'ç¦»', nature: 'ç«', attr: 'ä¸½' },
            '110': { name: 'å…‘', nature: 'æ³½', attr: 'æ‚¦' }
        };

        // 64å¦è§£æ
        const HEXAGRAM_MEANING = {
            'ä¹¾ä¹¾': { name: 'ä¹¾ä¸ºå¤©', conclusion: 'å¤§å‰', meaning: 'åˆšå¥ä¸­æ­£ï¼Œå…ƒäº¨åˆ©è´ï¼Œäº‹ä¸šå¯æˆ', decision: 'å¯ä»¥' },
            'å¤å¤': { name: 'å¤ä¸ºåœ°', conclusion: 'å‰', meaning: 'æŸ”é¡ºæ‰¿è½½ï¼Œåšå¾·è½½ç‰©ï¼Œé¡ºåŠ¿è€Œä¸º', decision: 'å¯ä»¥' },
            'éœ‡éœ‡': { name: 'éœ‡ä¸ºé›·', conclusion: 'ä¸­å‰', meaning: 'é›·å£°éœ‡åŠ¨ï¼ŒæƒŠè€Œä¸ä¹±ï¼Œæœ‰æƒŠæ— é™©', decision: 'å¯ä»¥' },
            'åå': { name: 'åä¸ºæ°´', conclusion: 'å‡¶', meaning: 'é™©é˜»é‡é‡ï¼Œéœ€è°¨æ…è¡Œäº‹ï¼Œæš‚ç¼“ä¸ºå®œ', decision: 'ä¸å®œ' },
            'è‰®è‰®': { name: 'è‰®ä¸ºå±±', conclusion: 'å¹³', meaning: 'é™æ­¢ç­‰å¾…ï¼Œæ—¶æœºæœªåˆ°ï¼Œå®œå®ˆä¸å®œæ”»', decision: 'æš‚ç¼“' },
            'å·½å·½': { name: 'å·½ä¸ºé£', conclusion: 'ä¸­å‰', meaning: 'é¡ºåŠ¿è€Œå…¥ï¼Œéšé£æ½œå…¥ï¼Œå¾ªåºæ¸è¿›', decision: 'å¯ä»¥' },
            'ç¦»ç¦»': { name: 'ç¦»ä¸ºç«', conclusion: 'å‰', meaning: 'å…‰æ˜ç£Šè½ï¼Œæ–‡æ˜ä¹‹è±¡ï¼Œå‰æ™¯å…‰æ˜', decision: 'å¯ä»¥' },
            'å…‘å…‘': { name: 'å…‘ä¸ºæ³½', conclusion: 'å‰', meaning: 'å–œæ‚¦å’Œé¡ºï¼Œæœ‰è´µäººç›¸åŠ©ï¼Œå¿ƒæƒ³äº‹æˆ', decision: 'å¯ä»¥' },
            'ä¹¾å¤': { name: 'å¤©åœ°å¦', conclusion: 'å‡¶', meaning: 'å¤©åœ°ä¸äº¤ï¼Œé—­å¡ä¸é€šï¼Œéœ€ç­‰å¾…æ—¶æœº', decision: 'ä¸å¯' },
            'å¤ä¹¾': { name: 'åœ°å¤©æ³°', conclusion: 'å¤§å‰', meaning: 'å¤©åœ°äº¤æ³°ï¼Œä¸‡äº‹äº¨é€šï¼Œæ­£æ˜¯è‰¯æœº', decision: 'å¯ä»¥' },
            'éœ‡å': { name: 'é›·æ°´è§£', conclusion: 'ä¸­å‰', meaning: 'é™©éš¾æ¸è§£ï¼Œè½¬å±ä¸ºå®‰ï¼Œè€å¿ƒç­‰å¾…', decision: 'å¯ä»¥' },
            'åéœ‡': { name: 'æ°´é›·å±¯', conclusion: 'å¹³', meaning: 'åˆå§‹è‰°éš¾ï¼Œéœ€ç§¯ç´¯åŠ›é‡ï¼Œä¸å®œæ€¥è¿›', decision: 'æš‚ç¼“' },
            'ç¦»å': { name: 'ç«æ°´æœªæµ', conclusion: 'å¹³', meaning: 'äº‹æœªæˆåŠŸï¼Œä»éœ€åŠªåŠ›ï¼Œè°¨æ…å‰è¡Œ', decision: 'æš‚ç¼“' },
            'åç¦»': { name: 'æ°´ç«æ—¢æµ', conclusion: 'å‰', meaning: 'æ°´ç«ç›¸æµï¼Œäº‹å·²æˆåŠŸï¼Œä¿æŒè°¨æ…', decision: 'å¯ä»¥' },
            'å…‘ä¹¾': { name: 'æ³½å¤©å¤¬', conclusion: 'ä¸­å‰', meaning: 'å†³æ–­ä¹‹æ—¶ï¼Œåˆšå†³æŸ”ï¼Œæ­£ä¹‰å¿…èƒœ', decision: 'å¯ä»¥' },
            'ä¹¾å…‘': { name: 'å¤©æ³½å±¥', conclusion: 'ä¸­å‰', meaning: 'å±¥é™©å¦‚å¤·ï¼Œä»¥ç¤¼å¾…äººï¼ŒåŒ–é™©ä¸ºå¤·', decision: 'å¯ä»¥' },
            'å·½è‰®': { name: 'é£å±±æ¸', conclusion: 'å‰', meaning: 'å¾ªåºæ¸è¿›ï¼Œç¨³æ­¥å‘å±•ï¼Œç»ˆå¾—æˆåŠŸ', decision: 'å¯ä»¥' },
            'è‰®å·½': { name: 'å±±é£è›Š', conclusion: 'å¹³', meaning: 'ç§¯å¼Šå·²ä¹…ï¼Œéœ€è¦æ•´é¡¿ï¼Œç¥›é™¤è…è´¥', decision: 'éœ€æ”¹è¿›' },
            'éœ‡è‰®': { name: 'é›·å±±å°è¿‡', conclusion: 'å¹³', meaning: 'å°äº‹å¯ä¸ºï¼Œå¤§äº‹ä¸å®œï¼Œè°¨å°æ…å¾®', decision: 'å°äº‹å¯' },
            'è‰®éœ‡': { name: 'å±±é›·é¢', conclusion: 'å‰', meaning: 'é¢å…»ä¹‹é“ï¼Œä¿®èº«å…»æ€§ï¼Œç§¯è“„åŠ›é‡', decision: 'å¯ä»¥' },
            'ç¦»å·½': { name: 'ç«é£é¼', conclusion: 'å¤§å‰', meaning: 'é¼æ–°é©æ•…ï¼Œå¤§å™¨æˆå°±ï¼Œå‰é€”å…‰æ˜', decision: 'å¯ä»¥' },
            'å·½ç¦»': { name: 'é£ç«å®¶äºº', conclusion: 'å‰', meaning: 'å®¶åº­å’Œç¦ï¼Œå†…å¤–æœ‰åºï¼Œæ¸©æš–å¦‚æ˜¥', decision: 'å¯ä»¥' },
            'å¤éœ‡': { name: 'åœ°é›·å¤', conclusion: 'å‰', meaning: 'å¤å…´ä¹‹è±¡ï¼Œå¦ææ³°æ¥ï¼Œè¿æ¥è½¬æœº', decision: 'å¯ä»¥' },
            'éœ‡å¤': { name: 'é›·åœ°è±«', conclusion: 'å‰', meaning: 'å’Œä¹é€šè¾¾ï¼Œå¿ƒæƒ…æ„‰æ‚¦ï¼Œå¯ä»¥è¡ŒåŠ¨', decision: 'å¯ä»¥' }
        };

        const DEFAULT_MEANINGS = {
            'ä¹¾': { conclusion: 'å‰', decision: 'å¯ä»¥' },
            'å¤': { conclusion: 'ä¸­å‰', decision: 'å¯ä»¥' },
            'éœ‡': { conclusion: 'ä¸­å‰', decision: 'å¯ä»¥' },
            'å': { conclusion: 'å‡¶', decision: 'ä¸å®œ' },
            'è‰®': { conclusion: 'å¹³', decision: 'æš‚ç¼“' },
            'å·½': { conclusion: 'ä¸­å‰', decision: 'å¯ä»¥' },
            'ç¦»': { conclusion: 'å‰', decision: 'å¯ä»¥' },
            'å…‘': { conclusion: 'å‰', decision: 'å¯ä»¥' }
        };

        // æ¨¡æ‹ŸæŠ›é“œé’±
        function castCoins() {
            const coins = [
                Math.random() > 0.5 ? 2 : 3,
                Math.random() > 0.5 ? 2 : 3,
                Math.random() > 0.5 ? 2 : 3
            ];
            const total = coins.reduce((a, b) => a + b, 0);

            if (total === 6) return ['0', true];      // è€é˜´
            else if (total === 7) return ['1', false]; // å°‘é˜³
            else if (total === 8) return ['0', false]; // å°‘é˜´
            else return ['1', true];                   // è€é˜³
        }

        // æ‰§è¡Œå åœ
        function divine() {
            const originalYao = [];
            const changingPositions = [];

            for (let i = 0; i < 6; i++) {
                const [yao, isChanging] = castCoins();
                originalYao.push(yao);
                if (isChanging) {
                    changingPositions.push(i + 1);
                }
            }

            const changedYao = originalYao.map((yao, idx) => {
                return changingPositions.includes(idx + 1) ? (yao === '1' ? '0' : '1') : yao;
            });

            return { originalYao, changedYao, changingPositions };
        }

        // è·å–å¦å
        function getBaguaName(yaoList) {
            const lower = yaoList.slice(0, 3).join('');
            const upper = yaoList.slice(3, 6).join('');
            
            const lowerGua = BAGUA[lower] || { name: 'æœªçŸ¥' };
            const upperGua = BAGUA[upper] || { name: 'æœªçŸ¥' };

            return [lowerGua.name, upperGua.name];
        }

        // è§£æå¦è±¡
        function interpret(originalYao, changedYao, changingPositions) {
            const [lowerOriginal, upperOriginal] = getBaguaName(originalYao);
            const hexagramKey = upperOriginal + lowerOriginal;

            let info;
            if (HEXAGRAM_MEANING[hexagramKey]) {
                info = HEXAGRAM_MEANING[hexagramKey];
            } else {
                const primary = DEFAULT_MEANINGS[upperOriginal] || { conclusion: 'å¹³', decision: 'å¾…è§‚å¯Ÿ' };
                info = {
                    name: `${upperOriginal}${lowerOriginal}`,
                    conclusion: primary.conclusion,
                    meaning: `${upperOriginal}å¦åœ¨ä¸Šï¼Œ${lowerOriginal}å¦åœ¨ä¸‹ï¼Œéœ€ç»¼åˆåˆ†æ`,
                    decision: primary.decision
                };
            }

            let changeNote = '';
            if (changingPositions.length > 0) {
                const [lowerChanged, upperChanged] = getBaguaName(changedYao);
                const changedHexagramKey = upperChanged + lowerChanged;
                
                if (HEXAGRAM_MEANING[changedHexagramKey]) {
                    const changedInfo = HEXAGRAM_MEANING[changedHexagramKey];
                    changeNote = `<br><br>å˜å¦ä¸ºã€${changedInfo.name}ã€‘ï¼Œæš—ç¤º${changedInfo.meaning}`;
                } else {
                    changeNote = `<br><br>å˜å¦ä¸ºã€${upperChanged}${lowerChanged}ã€‘ï¼Œäº‹æ€å°†æœ‰å˜åŒ–`;
                }
            }

            return {
                hexagramName: info.name,
                upperGua: upperOriginal,
                lowerGua: lowerOriginal,
                yaoSequence: originalYao.join(''),
                changingPositions: changingPositions,
                conclusion: info.conclusion,
                meaning: info.meaning + changeNote,
                decision: info.decision
            };
        }

        // æ˜¾ç¤ºçˆ»è±¡
        function displayYao(yaoList, changingPositions) {
            const yaoNames = ['åˆçˆ»', 'äºŒçˆ»', 'ä¸‰çˆ»', 'å››çˆ»', 'äº”çˆ»', 'ä¸Šçˆ»'];
            let html = '';

            for (let i = 5; i >= 0; i--) {
                const yao = yaoList[i];
                const name = yaoNames[i];
                const symbol = yao === '1' ? 'â”â”â”' : 'â” â”';
                const isChanging = changingPositions.includes(i + 1);

                html += `
                    <div class="yao-line">
                        <span>${name}:</span>
                        <span class="yao-symbol">${symbol}</span>
                        ${isChanging ? '<span class="changing-mark">â—‹ (å˜)</span>' : ''}
                    </div>
                `;
            }

            return html;
        }

        // ä¿å­˜å†å²
        function saveHistory(question, result) {
            const history = JSON.parse(localStorage.getItem('chunfengHistory') || '[]');
            history.push({
                timestamp: new Date().toLocaleString('zh-CN'),
                question: question || 'æœªè®°å½•é—®é¢˜',
                result: result
            });
            localStorage.setItem('chunfengHistory', JSON.stringify(history));
        }

        // æ˜¾ç¤ºå†å²
        function showHistory() {
            const history = JSON.parse(localStorage.getItem('chunfengHistory') || '[]');
            const historyList = document.getElementById('historyList');

            if (history.length === 0) {
                historyList.innerHTML = '<p style="text-align: center; color: #999;">æš‚æ— å†å²è®°å½•</p>';
                return;
            }

            historyList.innerHTML = history.slice(-10).reverse().map(record => `
                <div class="history-item">
                    <div class="history-time">â° ${record.timestamp}</div>
                    <div class="history-question">â“ ${record.question}</div>
                    <div class="history-result">
                        ğŸ“¿ ${record.result.hexagramName} | 
                        ğŸ”® ${record.result.conclusion} - ${record.result.decision}
                    </div>
                </div>
            `).join('');
        }

        // å¼€å§‹å åœ
        async function startDivination() {
            const question = document.getElementById('question').value;
            const loading = document.getElementById('loading');
            const result = document.getElementById('result');
            const history = document.getElementById('history');

            // éšè—ç»“æœå’Œå†å²
            result.classList.remove('show');
            history.classList.remove('show');

            // æ˜¾ç¤ºåŠ è½½
            loading.classList.add('show');

            // æ¨¡æ‹Ÿæ‘‡å¦è¿‡ç¨‹
            await new Promise(resolve => setTimeout(resolve, 1500));

            // æ‰§è¡Œå åœ
            const { originalYao, changedYao, changingPositions } = divine();
            const interpretResult = interpret(originalYao, changedYao, changingPositions);

            // éšè—åŠ è½½
            loading.classList.remove('show');

            // æ˜¾ç¤ºç»“æœ
            document.getElementById('yaoDisplay').innerHTML = displayYao(originalYao, changingPositions);
            
            let hexagramInfo = `ã€${interpretResult.hexagramName}ã€‘<br>`;
            hexagramInfo += `ä¸Šå¦: ${interpretResult.upperGua} | ä¸‹å¦: ${interpretResult.lowerGua}`;
            if (interpretResult.changingPositions.length > 0) {
                hexagramInfo += `<br>å˜çˆ»: ç¬¬ ${interpretResult.changingPositions.join(', ')} çˆ»`;
            }
            document.getElementById('hexagramName').innerHTML = hexagramInfo;
            
            document.getElementById('meaning').innerHTML = interpretResult.meaning;
            document.getElementById('conclusion').innerHTML = 
                `${interpretResult.conclusion} - ${interpretResult.decision}`;

            result.classList.add('show');

            // ä¿å­˜å†å²
            saveHistory(question, interpretResult);
        }

        // åˆ‡æ¢å†å²æ˜¾ç¤º
        function toggleHistory() {
            const result = document.getElementById('result');
            const history = document.getElementById('history');

            result.classList.remove('show');

            if (history.classList.contains('show')) {
                history.classList.remove('show');
            } else {
                showHistory();
                history.classList.add('show');
            }
        }
    </script>
</body>
</html>
